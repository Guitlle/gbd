\section{Introduction to ISM}

Integrative systems modeling (ISM) combines system dynamics modeling
with statistical modeling, by using a ``mechanistic'' model of process
together with a statistical model of data.  The foundations of ISM are
best articulated in terms of \emph{system dynamics modeling}, a
discipline that originated in the fields of operations research and
industrial engineering \ref{original works on GM, city, globe, systems
thinking primer}.  This sort of compartmental modeling may be familiar
from infectious disease modeling \ref{andersen and may, rohit and
premanji, vcycychy and, diekman and other} and pharmacokinetic
modeling \ref{jacquez1, jacquez2} as well, depending on the background
of the reader.

System dynamics modeling is an method to model the behavior of complex
systems in terms of stocks, flows, and feedback loops.  In short,
\emph{stock variables} quantify the amount of some
material, or mass, or population in a compartment at a particular
moment in time, while \emph{flow variables} quantify the rate of
material moving into, out of, or between compartments. The scope of
applications for system dynamics is enormous, and once you start
thinking of systems in this way, it may seem that everything can be
modeled as stocks and flows. It has been
applied to the study of complex systems in economics, politics,
environmental science, and a diverse array of other fields (see
\ref{System Dynamics a Primer, Jacquez Modeling with compartments, Consider a Spherical Cow} for an
introductions to this modeling approach).

Traditionally, there is a delineation between system dynamics modeling
and statistical modeling in the following way: system dynamics aims to
develop a \emph{model of process}, while statistical approaches focus
on developing a \emph{model of data}. Models of process attempt to
explicitly represent the mechanisms behind some system behavior
(deterministically or stochastically), while models of data often
explicitly avoid requiring such a theory. The advantage of using the
system dynamics approach is that it can incorporate structural
assumptions about the system.  However, in many applications, the
systems-dynamics model of process is not connected to data at all.  On
the other hand, in many statistical approaches, the domain-specific
dynamics of the system under study are not incorporated in the model
explicitly, and the data models cannot benefit from this additional
structure.  Integrative systems modeling is a framework to bring
together a model of process and a model of data for mutual benefit.

\subsection{An example}
An example will help to make these concepts more concrete.  TK
example of a one compartment model of a population, with in-flow of
births and out-flow of deaths.  Example of how this model can be
encoded as a difference equation or a differential equation, and a few
short examples of extensions that are of interest in different
domains: logistic growth in ecology, age-structure in demography,
employment in a firm in economics.  Adding additional compartments as
the next step in infectious disease modeling.

This model of process is distinct from traditional models of data used
in population modeling.  Example: crude mortality rates, age specific
mortality rates, fertility rates.  Connecting these models of data
together through a model of process could produce more precise
estimates of all quantities.is enough to build a sophisticated
predictor of population growth if combined with a model of data (and
some data). Need only know something about mortality rates and
fertility rates, for example from a household survey, and together the
integrative systems model can 

\subsection{Related Work}

The field of system dynamics has grown out of the work of Jay Forrester, a
management professor at MIT with a background in science and
engineering, in the 1950s. Its first application was in explaining
employment cycles at the company's appliance plants [ref TK]. Managers
incorrectly assumed that cycles merely followed general, economic
cycles, but by developing a compartmental model of the system
underlying GE's appliance business, Forrester showed that the
employment cycles arose from feedback loops inherent to GE's internal
structure. This first application demonstrates a major theme in system
dynamics. In complex systems, determinants of system behavior
considered one-by-one may be insufficient to predict the behavior of
that system. The most important behavior in a complex system arises
out of interactions and feedback between processes in that system. In
the case of disease modeling, the information contained in modeling
the entire disease process of incidence, remission and mortality
can exceed the information contained in separate
analyses of each of these features of the disease epidemiology.

TK paragraph on forward simulation, which includes an simple example,
such as the growth of a population, or use of a renewable resource.

Pharmacokinetic and pharmacodynamic (PKPD) modeling, a subdiscipline
of pharmacology, developed an approach to compartmental modeling in
tandem with system dynamics modeling, largely independently.  However,
the mathematics behind the models of process are extremely
similar. The compartments in PKPD models represent organs and other
physical systems in the body, and stocks represent the quantities of
pharmacologically relevant compounds in these compartments.  The flows
model the process of the drug of interest being metabolized or
otherwise passing through the subject. Mathematically, these models
have precise parallels to the stock-and-flow models developed by
Forrester and colleagues for supply chain analysis. For instance, in
one experiment researchers used a system dynamics approach to model
glucose kinetics. They found that a three compartment model where two
compartments correspond to peripheral pools exchanging plasma at
different rates with a central pool best represented the physiology of
glucose kinetics in their test subjects (in this case, a sample of 7
sheep) [ref TK]. This particular model structure has arisen several
times in applications in pharmacokinetics. It is called the mammillary
model. In another experiment, researchers modeled the kinetics of FULL
NAME TK (EACA) in 6 human subjects. EACA is compound used to control
hemorrhage in patients with bleeding problems. The PKPD researchers
developed a multi-compartmental model, where EACA was infused in a
central compartment, distributed to fast and slow excreting peripheral
compartments, and cleared by two compartments, one representing renal
excretion of the drug, and another representing non-renal excretion
[ref TK]. In both of these examples, and in general practice in
pharmacokinetics, the compartmental model-of-process is connected to a
statistical model-of-data to go beyond forward simulation to develop
methods of statistical inference for compartmental models. This
connection is the central idea of integrative systems modeling, and
one will be developed in detail in later chapters.

There has increasing interest in applying system dynamics principles
to the modeling of health and health systems. Health systems are
particularly complex, with many actors and many feedback loops,
providing a large supply of systems modeling opportunities. The health
of a population is affected by a combination of biological, economic,
demographic, and political forces, and all of these spheres interact
in a unexpected ways. Since the 1970s, system dynamics models have
been applied to model these various forces in order to advance our
understanding of population health [refs TK]. The topics addressed
have included: disease epidemiology, substance abuse epidemiology,
patient flows in emergency care, health care capacity and delivery,
and interactions between health care and disease epidemiology. A
systems approach is often required, because isolating one part of a
public health problem and then addressing that may in fact adversely
affect other parts of the system. For instance, low tar/nicotine
cigarettes were developed to address one part of the burden of disease
caused by tobacco consumption, but consumer behavior was not taken
into account. Consumers tended to take longer, more frequent drags and
thus negated the benefit of the low tar/nicotine content [ref TK]. A
system approach would seek to simultaneously account for both the
effect of the tobacco product on the consumer and the consumer's
behavior. In the context of modeling the progression of a disease
through a population, a model that seems to describe infection
dynamics accurately may conflict with data on remission or
fatality. Only by modeling the three together can the analyst get the
most accurate and consistent estimates.

One area in which public health has a long tradition of compartmental
and system dynamics modeling is in infectious disease [ref Andersen
  and May, Heathecote, Sally Blower, others? see wikipedia
  compartmental models in epi page]. For example, the
Susceptible-Infected-Recovered compartmental model, which was discussed in
Section~\ref{TK}. This basic model has been extended in a variety of
ways in order to model increasingly more complex infectious disease
dynamics. For instance, in one study Nagelkerke and colleagues modeled
the impact of a range of interventions targeted at preventing
transmission of HIV/AIDS epidemics [ref]. They estimated impact using a
compartmental model where the population moved from an Uninfected
compartment to either treated or untreated Infected
compartments to an AIDS compartment to a Death from AIDS
compartment. 

Another example that makes an explicit connection between
epidemiological modeling and system dynamics is the recent work by
Kershenobich and colleagues, who applied a systems approach to
forecasting the prevalence of hepatitis C. They developed a
compartmental model tracking incidence, diagnosis and treatment of the
disease. For the incident population in the model, an individual moves
from an acute phase (which lasts for 6 months) to a chronic phase,
unless that individual is spontaneously cleared of the disease, is
treated and cured or dies. For the prevalent population in the model,
an individual moves from viraemic to non-viraemic, dies or gets
treated and cured. Separate models were also used to estimate the
mortality rate in different countries based on age, liver-related
deaths due to hepatitis C infection, and percent of the population
infected by infection drug users. Sensitivity analyses were conducted
by running the model for a number of input scenarios.  TK description
of what this model allowed the authors to do, and especially how hard
it would have been to do in any other way.

System dynamics has been applied not only to the study of disease
processes, but also the health system. Flaxman and colleagues
developed a stock-and-flow model to synthesize data on the
availability and distribution of insecticide treated bednets (ITNs)
and to predict the proportion of households who owned an ITN. This
analysis employed a Bayesian approach to estimate the parameters of
the compartmental model that describe the process of ITNs moving from
warehouses and other storage facilities into the household and
possibly getting discarded by the households or lost in the
distribution process.



TK connection to the references cited in this NIH RFP for systems modeling
\url{http://grants.nih.gov/grants/guide/pa-files/PAR-08-224.html}
\url{http://ajph.aphapublications.org/cgi/content/full/96/3/452}
\url{http://www.hpsig.com/images/f/f5/SD_background_for_public_health_%284.11.05%29.pdf}
\url{http://www.systemswiki.org/index.php?title=Health_System_Dynamics_References}
\url{http://www.chronicdisease.org/nacdd-initiatives/diabetes/professional-development/act-on-data/SDMResourceList.pdf}

TK review of all pubmed literature that has term system dynamics in
the keywords or something.

TK discussion of bednets model and analogy between this and population
PK approach.

TK transition paragraph going from ISM in general to the specific
model to be used in model-based meta-regression for the GBD.

\section{System dynamics model of disease in a population}
At the heart of the model-based meta-regression that this book
presents is a system dynamics model consisting of four
compartments, which represents the ``fundamental equations'' of population
health. The compartments contain the following: the population susceptible to the
disease ($S$), the population with the condition ($C$), the population
dead due to other causes ($M$), and the population dead due to the
disease ($D$). The population moves between these boxes following the
arrows shown in figure~\ref{stock-flow-fig}, transitioning from $S$ to $C$ with incidence
rate $i$, and from $C$ back to $S$ with remission rate $r$. The susceptible
population transitions into box $M$ with (without-condition) mortality
rate $m$, and the with-condition population transitions into box $M$ with
without-condition mortality rate $m$, and into by $D$ with ``excess
mortality rate'' $f$.

This ``model of process'' is deceptively simple, and compared to the
 complex systems often developed in infectious disease modeling
 it \emph{is} quite simple.  However, it is no simpler than needed,
 and matches well the myriad of available data about the descriptive
 epidemiology of disease.  In the coming sections, we will connect this
 model of process to an appropriately complex model of data, and
 together they will provide our integrative systems model for
 model-based meta-regression.

There is an analogy of this simple model of process to the
 basic demographic equation of demography (also known as the
 fundamental balancing equation) \ref{demography}, which says that the population at
 time $t+\Delta t$ is equal to the population at time $t$, minus the
 number of deaths, plus the number of births, minus out migration,
 plus in migration:
\[P_{t+\Delta t} = P_t + B_{t, \Delta t} - D_{t, \Delta t} +
 I_{t, \Delta t} - E_{t, \Delta t},
\]
where $P_t$ is the population at time $t$, $B_{t, \Delta t}$ and
 $D_{t, \Delta t}$ are the
 number of births and deaths between time $t$ and $t+\Delta t$, and
 $I_{t, \Delta t}$ and $E_{t, \Delta t}$ are the number of immigrants
 and emigrants from the population between time $t$ and $t+\Delta t$
 \url{http://books.google.com/books?id=CR-EXq4y8XAC&lpg=PA5&ots=_jJryixe4z&dq=%22basic%20demographic%20equation%22&pg=PA6#v=onepage&q=%22basic%20demographic%20equation%22&f=false}

TK transition in to compartmental model.

\begin{figure}
\begin{center}
\includegraphics[width=\textwidth]{compartments.pdf}
\end{center}
\caption{The model of process has $2$ compartments, which contain
individuals ``susceptible'' ($S$)  and ``with condition'' ($C$),
and transitions between compartments of incidence rate ($i$), remission
  rate ($r$), without-condition mortality rate ($m$), and excess
  mortality rate ($f$).}
\label{fig:compartmental-model}
\end{figure}

Although this section of the book deals explicitly with the model of
process and not with the model of data, it is helpful to pause here
and reflect on what data is available and how it corresponds to the
stocks and flows in the model.

For certain especially infectious diseases, cases identified in the
health system are required to be promptly reported to the WHO.  For
example, the incidence of leprosy.  This yields data on disease
incidence rates (which is not age-specific, i.e. crude incidence rate
over all ages).  All caveats about case-reports and health system
access are defered to future sections, but the number of cases per
year divided by the midyear population provides a measurement of
something closely related to the (instantaneous) incidence rate $i$ in
the figure above.

Often it is prevalence that is directly measured, for example through
a household or telephone survey.  This sort of research provides
measurements of the form $k$ out of $n$ respondants said that they had
condition (or, less frequently, tested positive for the condition).
This provides a measurment of the ratio of compartments in the stock
and flow model above, prevalence $p$ is equal to $C/(S+C)$.  Often
this information will be stratified by age and/or sex, and for many
important diseases, the prevalence level will vary by orders of
magnitude over the age range of the population.

There is another common sort of study on the relative mortality ratio
of a disease, that measures the mortality rate in people with the
disease and without the disease, and reports the ratio (sometime
called the relative risk $RR$).  This corresponds to a ratio of rates in
the model above, $RR = (m+f) / m$.  Unfortunately, neither $m$ nor $f$
is measured routinely, but the with-condition mortality is sometimes
reported instead of $RR$, which can be represented as $m_{with} =
m+f$.  The all-cause mortality for a population can also be derived
from the model, as $m + pf$.  The quantity $pf$ is important in its
own right, because for conditions that are unambiguously coded as the
cause of death on death certificates, the population-level
cause-specific mortality rate (i.e. the fraction of death certificates
with this cause coded as the underlying cause of death) is a
measurement of $pf$.  Even for conditions where the death certificates
are not likely to be coded to this cause for all deaths
(e.g. diabetes), the population-level cause-specific mortality rate is
a lower bound on $pf$, which can still provide useful information.

Remission and duration studies provide yet another measurement that
corresponds to parameters in this model.

The amount of data for each of these types of parameters varies widely
for diseases that have been analyzed in the GBD2010 study. Some have
many and more, while others have only prevalence or only incidence
(and not much of that). The gap and the bridges between what we know
and what we want to know will be explored in theory and practice in
several later sections of this book.

Conceptually, it is excess mortality $f$ that has proven hardest to
explain and to understand. This is because in most cases $f$ is a
latent variable, unobservable through most any epi study. Perhaps it
would be clearer to talk about the with-condition mortality rate,
which at least can be measured through a cohort study, and I think
will feel more familiar to the doctor or
epidemiologist. With-condition mortality is $m+f$, and the fact that
$M$ and $D$ are different boxes really is not that important when we
are doing generic disease modeling.

This 4 compartment model is really only a sketch of system dynamics
model I've used however, because it does not show age or time
information. In fact, there are large differences in disease
parameters such as incidence and prevalence as a function of age, and
it is essential for a model to take this into account.  Congenital
abnormalities all have a birth prevalence, while important diseases
such as dementia and Alzheimer's disease have much higher incidence
and prevalence at older ages. Furthermore the incidence and prevalence
of disease, as well as the remission rates and excess-mortality rates
change over time due to shifts in population, changes in prevention or
treatment, or changes in care. And the interdependence between these
factors is complex, but unignorable: today's 50-year-olds population
will be tomorrow's 51-year-olds.

For these reasons, the 4 compartment model is more of a heuristic or
intuitive description of the system dynamics than a precise formal
definition.  Useful as they are for summarizing system dynamics and
clarifying the important relationships, stock-and-flow figures are
simply not up to the task of giving a full and precise
definition of a system dynamics model, at least not to the level
needed for integrative systems modeling.  This is best left to a system
of partial differential equations, describing the change in the size
of the compartments as a function of age and time.

The full model is governed by the following system of partial
differential equations:
\begin{align*}
\frac{\partial S}{\partial (a+t)} &= -(i + m)S + rC,\\
\frac{\partial C}{\partial (a+t)} &= iS - (r + m + f)C,\\
\end{align*}
where
\begin{align*}
S &= S(a,t) = \text{stock of ``susceptibles'' of age $a$ at time $t$}\\
C &= C(a,t) = \text{stock of ``with condition'' of age $a$ at
  time $t$}\\[.1in]
i &= i(a,t) = \text{incidence rate for susceptibles of age $a$ at time $t$}\\
r &= r(a,t) = \text{remission rate for individuals with condition of age $a$ at time $t$}\\
m &= m(a,t) = \text{without-condition mortality rate for any individuals of age $a$ at
time $t$}\\
f &= f(a,t) = \text{excess-mortality rate for individuals with
condition of age $a$ at time
  $t$}
\end{align*}

\subsection{Endemic equlibrium}
\label{theory-forward_sim-compartmental_model-simplying_assumptions}

The full model above is often more complex than can be supported by
available data, which is usually very sparse and very noisy.  An
important simplification in almost all know cases is the assumption
that the disease parameters are not changing substantially with
respect to time. To be precise, the assumption that the disease is in
endemic equilibrium is implemented by setting the partial derivative
of all stocks and all flows to zero with respect to time:
\[
\frac{\partial S}{\partial t}
=
\frac{\partial C}{\partial t}
=
\frac{\partial D}{\partial t}
=
\frac{\partial M}{\partial t}
=
\frac{\partial i}{\partial t}
=
\frac{\partial r}{\partial t}
=
\frac{\partial m}{\partial t}
=
\frac{\partial f}{\partial t}
=
0.
\]

This assumption on time derivatives deserves careful assessment, and
is returned to in detail through simulation study in
Section~\ref{time-varying-sim}.

Although the primary use of this model is for inference of model
parameters (sometimes called the ``inverse problem''), I can easily
apply it ``forwards'' to show how rates on incidence, remission, and
excess-mortality produce different prevalence curves. The next section
explores this forward simulation through a series of detailed
examples, to build up the reader's intuition around how consistency
forces interrelationships between prevalence, incidence, remission,
and mortality.


\section{Forward simulation examples}

When a generic disease model is initialized with all-cause mortality
data and nothing else, the initial values produce the following set of
consistent age patterns:

\includegraphics[width=\textwidth]{initial.pdf}

The next example shows that increasing the remission rate with
incidence and excess mortality unchanged (and all-cause mortality
unchanged as well) leads to a very different age pattern for
prevalence. It is also worth pointing out that since prevalence has
changed with excess mortality and all-cause mortality rates held
constant, the with-condition and background mortality rates have also
changed to maintain consistency.

\includegraphics[width=\textwidth]{more-remission.pdf}

By changing the incidence rate age pattern to be increasing as a
function of the square root age, I can demonstrate that very similar
prevalence rates are consistent with very different incidence and
remission rates.

\includegraphics[width=\textwidth]{increasing-incidence.pdf}

Although the prevalence age pattern is largely determined by the
remission, incidence, and mortality rates, the birth prevalence can
also change the shape dramatically.  Here are the results of the same
remission, incidence, and mortality rates as above, but with a birth
prevalence of 20\%.

\includegraphics[width=\textwidth]{birth-prevalence.pdf}

An interesting, and perhaps unexpected feature of this set of
consistent rates above is that when prevalence levels start so high,
the levels remain high during the teenage years, where all-cause
mortality rates are quite low in this population (following the rates
for males in the North American High Income region in 2005), which
produces very low levels of background mortality for these age
groups. In other words, in order for the model to be consistent, it is
necessary to assume that the vast preponderance of teenage deaths are
due to this disease.

Finally, the excess mortality rate (which is the most difficult of the
rates to conceptualize, due to its unobservability) has an effect of
modulating the prevalence that is similar to the remission rate,
although not identical.  The final figure in this series shows the
results of choosing an excess mortality rate to have an age function
equal to ten times the all-cause mortality rate (which is to say a
standardized mortality rate of constant value eleven for all ages).

\includegraphics[width=\textwidth]{higher-smr.pdf}

The decreasing prevalence after age 65 is worthy of remarking
on. Although the incidence rate is increasing and the remission rate
remains unchanged, having a constant (albeit high) standardized
mortality ratio means that when all-cause mortality rises, the
with-condition mortality rises differentially with such magnitude that
the prevalence of the condition in older populations goes down.

To summarize, this series of figures has shown the intuitive and
less-than-intuitive way that the levels and age patterns of different
epidemiological parameters must be interrelated to satisfy the
fundamental equations of population health (when disease rates for
each age are changing negligibly slowly as a function of time).

The next series of figures continues to build familiarity with the
features of consistent disease modeling, by selecting age patterns for
certain rates based on toy models of a variety of diseases.  For
example, for a disorder like depression, for which there is primarily
incidence in early adulthood, high remission rate, and low excess
mortality, the consistency conditions produce a prevalence age pettern
that peaks at age 25: 

\includegraphics[width=\textwidth]{forward-sim-mental.pdf}

For a congenital disorder, like TK, with birth prevalence, no
incidence after birth, no remission, and substantial mortality, the
consistent prevalence age pattern is the following:

\includegraphics[width=\textwidth]{forward-sim-congenital.pdf}

For a disorder that affects the elderly, like TK, the consistent age
patterns for mortality, incidence, remission, and prevalence could
look like the following: 

\includegraphics[width=\textwidth]{forward-sim-old_age.pdf}

And for a disorder related to the reproductive system, like TK, with
substantial excess mortality and incidence during ages 15-60, and
remission that increases substantially at age 55, the consistent age
patterns could look like the following: 

\includegraphics[width=\textwidth]{forward-sim-reproductive.pdf}

To conclude this series of plots, I've included an "incidence impulse
response" example, showing the prevalence produced to be consistent
with an incidence pattern that is only nonzero for a single age group:

\includegraphics[width=\textwidth]{forward-sim-incidence_pulse.pdf}

This also provides a mechanism to investigate how wrong the estimates
may become when the assumption that rates are constant over time (for
a given age) is violated. This is the core of my simulation approach
to model validation, to which I will return in section TK.

TK The simulation study approach can be described in full detail here
as well, and can serve as justification for decisions described in the
next two chapters.

\section{What happens to prevalence when the disease incidence or remission or mortality is not constant over time?}

Certain important diseases such as diabetes are widely believed to
have substantial changes in incidence, remission, and mortality rates
over time.  What is the effect of the endemic equilibrium assumption
of the age-specific prevalence. TK plots comparing prevalence from a
synthetic cohort model to a period model using simulation data.
